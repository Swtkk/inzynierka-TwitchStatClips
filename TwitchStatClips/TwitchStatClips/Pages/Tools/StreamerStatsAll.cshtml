@page
@model TwitchStatClips.Pages.Tools.StreamerStatsAllModel

@{
    ViewData["Title"] = "Statystyki streamerów";
}

<h2>Statystyki streamerów</h2>

<ul class="nav nav-tabs mb-3">
    <li class="nav-item">
        <a class="nav-link @(Model.Data.Range=="24h" ? "active" : "")"
           asp-page="./StreamerStatsAll"
           asp-route-range="24h"
           asp-route-pageNumber="1"
           asp-route-pageSize="@Model.Data.PageSize"
           asp-route-sortBy="@Model.Data.SortBy"
           asp-route-sortDir="@Model.Data.SortDir"
           asp-route-language="@Model.Data.Language"
           asp-route-game="@Model.Data.Game">
            Ostatnie 24h
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link @(Model.Data.Range=="7d" ? "active" : "")"
           asp-page="./StreamerStatsAll"
           asp-route-range="7d"
           asp-route-pageNumber="1"
           asp-route-pageSize="@Model.Data.PageSize"
           asp-route-sortBy="@Model.Data.SortBy"
           asp-route-sortDir="@Model.Data.SortDir"
           asp-route-language="@Model.Data.Language"
           asp-route-game="@Model.Data.Game">
            Ostatnie 7d
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link @(Model.Data.Range=="30d" ? "active" : "")"
           asp-page="./StreamerStatsAll"
           asp-route-range="30d"
           asp-route-pageNumber="1"
           asp-route-pageSize="@Model.Data.PageSize"
           asp-route-sortBy="@Model.Data.SortBy"
           asp-route-sortDir="@Model.Data.SortDir"
           asp-route-language="@Model.Data.Language"
           asp-route-game="@Model.Data.Game">
            Ostatnie 30d
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link @(Model.Data.Range=="all" ? "active" : "")"
           asp-page="./StreamerStatsAll"
           asp-route-range="all"
           asp-route-pageNumber="1"
           asp-route-pageSize="@Model.Data.PageSize"
           asp-route-sortBy="@Model.Data.SortBy"
           asp-route-sortDir="@Model.Data.SortDir"
           asp-route-language="@Model.Data.Language"
           asp-route-game="@Model.Data.Game">
            Ogólne
        </a>
    </li>
</ul>

<form method="get" class="stats-filters d-flex gap-3 flex-wrap align-items-end">

    <!-- Zakres (ukryty, zachowujemy wybór zakładki) -->
    <input type="hidden" name="range" value="@Model.Data.Range" />
    <input type="hidden" name="sortBy" value="@Model.Data.SortBy" />
    <input type="hidden" name="sortDir" value="@Model.Data.SortDir" />

    <!-- Na stronę -->
    <div class="filter-group">
        <label class="filter-label">Na stronę:</label>
        <select name="pageSize" class="filter-select" onchange="this.form.submit()">
            @foreach (var size in new[] { 25, 50, 100 })
            {
                <option value="@size" selected="@(Model.Data.PageSize == size)">
                    @size
                </option>
            }
        </select>
    </div>

    <!-- Język -->
    <div class="filter-group">
        <label class="filter-label">Język:</label>
        <select name="language" class="filter-select" onchange="this.form.submit()">
            <option value="">Wszystkie</option>
            @foreach (var lang in Model.Data.LanguageOptions)
            {
                <option value="@lang" selected="@(Model.Data.Language == lang)">
                    @lang
                </option>
            }
        </select>
    </div>

    <!-- Gra -->
    <div class="filter-group">
        <label class="filter-label">Gra:</label>
        <select name="game" class="filter-select" onchange="this.form.submit()">
            <option value="">Wszystkie</option>
            @foreach (var g in Model.Data.GameOptions)
            {
                <option value="@g" selected="@(Model.Data.Game == g)">
                    @g
                </option>
            }
        </select>
    </div>

</form>



@{
    // to jest JEDYNE miejsce, gdzie rysujemy tabelę
    ViewData["StatsVm"] = Model.Data;
}
@await Html.PartialAsync("_StatsTable", Model.Data.Items)

@if (Model.Data.TotalPages > 1)
{
    <nav aria-label="Paginacja">
        <ul class="pagination mt-3">
            <li class="page-item @(Model.Data.PageNumber == 1 ? "disabled" : "")">
                <a class="page-link"
                   asp-page="./StreamerStatsAll"
                   asp-route-range="@Model.Data.Range"
                   asp-route-pageNumber="@(Model.Data.PageNumber - 1)"
                   asp-route-pageSize="@Model.Data.PageSize"
                   asp-route-sortBy="@Model.Data.SortBy"
                   asp-route-sortDir="@Model.Data.SortDir"
                   asp-route-language="@Model.Data.Language"
                   asp-route-game="@Model.Data.Game">
                    « Poprzednia
                </a>
            </li>

            <li class="page-item disabled">
                <span class="page-link">
                    Strona @Model.Data.PageNumber z @Model.Data.TotalPages
                </span>
            </li>

            <li class="page-item @(Model.Data.PageNumber == Model.Data.TotalPages ? "disabled" : "")">
                <a class="page-link"
                   asp-page="./StreamerStatsAll"
                   asp-route-range="@Model.Data.Range"
                   asp-route-pageNumber="@(Model.Data.PageNumber + 1)"
                   asp-route-pageSize="@Model.Data.PageSize"
                   asp-route-sortBy="@Model.Data.SortBy"
                   asp-route-sortDir="@Model.Data.SortDir"
                   asp-route-language="@Model.Data.Language"
                   asp-route-game="@Model.Data.Game">
                    Następna »
                </a>
            </li>
        </ul>
    </nav>
}
